<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="日本茶AI診断 - 質問に答えて最適な茶葉を推奨。AIがあなたの好みを分析します">
    <meta name="keywords" content="日本茶, AI診断, 茶葉推奨, 味覚分析, インタラクティブ">
    
    <title>Tea AI Diagnosis - nemotea</title>
    
    <link rel="stylesheet" href="../../assets/css/main.css">
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon.ico">
    
    <style>
        body {
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .diagnosis-hero {
            padding: var(--space-2xl) 0;
            text-align: center;
            position: relative;
        }

        .ai-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto var(--space-xl);
            background: linear-gradient(135deg, #2d5016, #4a7c59);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(45, 80, 22, 0.4);
            animation: aiPulse 3s ease-in-out infinite alternate;
        }

        @keyframes aiPulse {
            0% { box-shadow: 0 0 40px rgba(45, 80, 22, 0.4); }
            100% { box-shadow: 0 0 60px rgba(74, 124, 89, 0.6); }
        }

        .ai-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: rotate 4s linear infinite;
        }

        .diagnosis-container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .question-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: var(--space-2xl);
            margin: var(--space-xl) 0;
            position: relative;
            overflow: hidden;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.5s ease;
        }

        .question-card.active {
            opacity: 1;
            transform: translateY(0);
        }

        .question-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #2d5016, #4a7c59, var(--cyber-green));
        }

        .question-header {
            display: flex;
            align-items: center;
            margin-bottom: var(--space-lg);
        }

        .question-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #2d5016, #4a7c59);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: var(--space-md);
            box-shadow: 0 0 20px rgba(45, 80, 22, 0.3);
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }

        .option-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: var(--space-lg);
            cursor: pointer;
            transition: all var(--transition-normal);
            text-align: center;
            position: relative;
        }

        .option-card:hover {
            transform: translateY(-3px);
            border-color: rgba(45, 80, 22, 0.5);
            box-shadow: 0 8px 25px rgba(45, 80, 22, 0.3);
        }

        .option-card.selected {
            border-color: #4a7c59;
            background: rgba(45, 80, 22, 0.1);
            box-shadow: 0 0 30px rgba(74, 124, 89, 0.4);
        }

        .option-icon {
            font-size: 3rem;
            margin-bottom: var(--space-md);
            display: block;
        }

        .option-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: var(--space-sm);
            color: var(--text-primary);
        }

        .option-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .progress-section {
            margin: var(--space-xl) 0;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: var(--space-md) 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2d5016, #4a7c59);
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: var(--space-xl);
        }

        .nav-button {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: var(--space-md) var(--space-xl);
            cursor: pointer;
            transition: all var(--transition-normal);
            color: var(--text-primary);
            font-weight: 600;
        }

        .nav-button:hover {
            background: rgba(45, 80, 22, 0.2);
            border-color: rgba(45, 80, 22, 0.5);
            box-shadow: 0 0 20px rgba(45, 80, 22, 0.3);
        }

        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-button.primary {
            background: linear-gradient(45deg, #2d5016, #4a7c59);
            color: white;
            box-shadow: 0 0 20px rgba(45, 80, 22, 0.4);
        }

        .result-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: var(--space-2xl);
            margin: var(--space-xl) 0;
            text-align: center;
            position: relative;
            overflow: hidden;
            display: none;
        }

        .result-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #2d5016, #4a7c59, var(--cyber-green));
        }

        .result-tea-icon {
            font-size: 6rem;
            margin-bottom: var(--space-lg);
            display: block;
            filter: drop-shadow(0 0 20px rgba(45, 80, 22, 0.5));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .result-tea-name {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: var(--space-md);
            background: linear-gradient(45deg, #2d5016, #4a7c59);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .result-description {
            font-size: 1.1rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: var(--space-xl);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-lg);
            margin: var(--space-xl) 0;
        }

        .result-detail {
            background: rgba(45, 80, 22, 0.1);
            border-radius: 12px;
            padding: var(--space-lg);
        }

        .detail-label {
            font-size: 0.9rem;
            color: #4a7c59;
            font-weight: 600;
            margin-bottom: var(--space-xs);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .detail-value {
            font-size: 1.1rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .taste-profile {
            margin: var(--space-xl) 0;
        }

        .taste-bar {
            display: flex;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .taste-label {
            min-width: 80px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .taste-track {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 0 var(--space-sm);
            overflow: hidden;
        }

        .taste-fill {
            height: 100%;
            background: linear-gradient(90deg, #2d5016, #4a7c59);
            border-radius: 3px;
            transition: width 1s ease;
        }

        .taste-value {
            min-width: 30px;
            font-size: 0.8rem;
            color: #4a7c59;
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            margin-top: var(--space-xl);
            flex-wrap: wrap;
        }

        .action-button {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: var(--space-md) var(--space-lg);
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 600;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .action-button:hover {
            background: rgba(45, 80, 22, 0.2);
            border-color: rgba(45, 80, 22, 0.5);
            box-shadow: 0 0 20px rgba(45, 80, 22, 0.3);
        }

        .action-button.primary {
            background: linear-gradient(45deg, #2d5016, #4a7c59);
            color: white;
        }

        .loading-section {
            text-align: center;
            padding: var(--space-2xl);
            display: none;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(45, 80, 22, 0.3);
            border-top: 3px solid #4a7c59;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--space-lg);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
        }

        .loading-subtitle {
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .options-grid {
                grid-template-columns: 1fr;
            }

            .result-details {
                grid-template-columns: 1fr;
            }

            .navigation-buttons {
                flex-direction: column;
                gap: var(--space-md);
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ヘッダーナビゲーション -->
        <header class="glass-header mt-md">
            <nav class="nav">
                <a href="../../" class="nav-logo">nemotea.dev</a>
                <ul class="nav-items">
                    <li><a href="../../" class="nav-item">Home</a></li>
                    <li><a href="../../profile/" class="nav-item">Profile</a></li>
                    <li><a href="../../works/" class="nav-item active">Works</a></li>
                    <li><a href="../../podcast/" class="nav-item">Podcast</a></li>
                    <li><a href="../../contact/" class="nav-item">Contact</a></li>
                </ul>
            </nav>
        </header>

        <!-- AI診断ヒーロー -->
        <section class="diagnosis-hero">
            <div class="ai-icon fade-in">
                <span style="position: relative; z-index: 2;">🤖</span>
            </div>
            
            <h1 class="text-hero fade-in">Tea AI Diagnosis</h1>
            <p class="text-subtitle fade-in mb-lg">
                あなたにピッタリの日本茶をAIが診断
            </p>
            <p class="text-body fade-in" style="max-width: 600px; margin: 0 auto;">
                5つの質問に答えるだけで、あなたの味覚傾向を分析し、<br>
                最適な日本茶を推奨します。AIがあなたの好みを学習します。
            </p>
        </section>

        <!-- 診断コンテナ -->
        <div class="diagnosis-container">
            <!-- 進捗表示 -->
            <div class="progress-section fade-in">
                <div class="progress-text">質問 <span id="current-question">1</span> / <span id="total-questions">5</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>
            <!-- 質問1: お茶を飲む時間帯 -->
            <div class="question-card active" data-question="1">
                <div class="question-header">
                    <div class="question-number">1</div>
                    <div class="question-text">お茶を飲むのはいつが多いですか？</div>
                </div>
                <div class="options-grid">
                    <div class="option-card" data-value="morning">
                        <span class="option-icon">🌅</span>
                        <div class="option-title">朝</div>
                        <div class="option-description">目覚めの一杯として</div>
                    </div>
                    <div class="option-card" data-value="afternoon">
                        <span class="option-icon">☀️</span>
                        <div class="option-title">昼</div>
                        <div class="option-description">食事と一緒に</div>
                    </div>
                    <div class="option-card" data-value="evening">
                        <span class="option-icon">🌆</span>
                        <div class="option-title">夕方</div>
                        <div class="option-description">仕事の合間に</div>
                    </div>
                    <div class="option-card" data-value="night">
                        <span class="option-icon">🌙</span>
                        <div class="option-title">夜</div>
                        <div class="option-description">リラックスタイムに</div>
                    </div>
                </div>
            </div>

            <!-- 質問2: 味の好み -->
            <div class="question-card" data-question="2">
                <div class="question-header">
                    <div class="question-number">2</div>
                    <div class="question-text">どんな味がお好みですか？</div>
                </div>
                <div class="options-grid">
                    <div class="option-card" data-value="sweet">
                        <span class="option-icon">🍯</span>
                        <div class="option-title">甘い</div>
                        <div class="option-description">まろやかで優しい甘味</div>
                    </div>
                    <div class="option-card" data-value="bitter">
                        <span class="option-icon">🌿</span>
                        <div class="option-title">苦い</div>
                        <div class="option-description">しっかりとした苦味</div>
                    </div>
                    <div class="option-card" data-value="astringent">
                        <span class="option-icon">🍃</span>
                        <div class="option-title">渋い</div>
                        <div class="option-description">引き締まる渋味</div>
                    </div>
                    <div class="option-card" data-value="umami">
                        <span class="option-icon">🌊</span>
                        <div class="option-title">旨い</div>
                        <div class="option-description">深い旨味とコク</div>
                    </div>
                </div>
            </div>

            <!-- 質問3: 香りの好み -->
            <div class="question-card" data-question="3">
                <div class="question-header">
                    <div class="question-number">3</div>
                    <div class="question-text">どんな香りが好きですか？</div>
                </div>
                <div class="options-grid">
                    <div class="option-card" data-value="fresh">
                        <span class="option-icon">🌱</span>
                        <div class="option-title">青草系</div>
                        <div class="option-description">新鮮で爽やかな青草の香り</div>
                    </div>
                    <div class="option-card" data-value="floral">
                        <span class="option-icon">🌸</span>
                        <div class="option-title">花香系</div>
                        <div class="option-description">上品で華やかな花の香り</div>
                    </div>
                    <div class="option-card" data-value="roasted">
                        <span class="option-icon">🔥</span>
                        <div class="option-title">焙煎系</div>
                        <div class="option-description">香ばしいロースト香</div>
                    </div>
                    <div class="option-card" data-value="marine">
                        <span class="option-icon">🌊</span>
                        <div class="option-title">海苔系</div>
                        <div class="option-description">深みのある海苔の香り</div>
                    </div>
                </div>
            </div>

            <!-- 質問4: 濃さの好み -->
            <div class="question-card" data-question="4">
                <div class="question-header">
                    <div class="question-number">4</div>
                    <div class="question-text">お茶の濃さはどちらがお好みですか？</div>
                </div>
                <div class="options-grid">
                    <div class="option-card" data-value="light">
                        <span class="option-icon">💧</span>
                        <div class="option-title">薄め</div>
                        <div class="option-description">軽やかで飲みやすい</div>
                    </div>
                    <div class="option-card" data-value="medium">
                        <span class="option-icon">🍵</span>
                        <div class="option-title">普通</div>
                        <div class="option-description">バランスの取れた濃さ</div>
                    </div>
                    <div class="option-card" data-value="strong">
                        <span class="option-icon">💪</span>
                        <div class="option-title">濃いめ</div>
                        <div class="option-description">しっかりとした味わい</div>
                    </div>
                </div>
            </div>

            <!-- 質問5: 飲むシーン -->
            <div class="question-card" data-question="5">
                <div class="question-header">
                    <div class="question-number">5</div>
                    <div class="question-text">どんなシーンで飲むことが多いですか？</div>
                </div>
                <div class="options-grid">
                    <div class="option-card" data-value="work">
                        <span class="option-icon">💻</span>
                        <div class="option-title">仕事中</div>
                        <div class="option-description">集中力を高めたい</div>
                    </div>
                    <div class="option-card" data-value="relax">
                        <span class="option-icon">🧘</span>
                        <div class="option-title">リラックス</div>
                        <div class="option-description">ゆったりと過ごしたい</div>
                    </div>
                    <div class="option-card" data-value="meal">
                        <span class="option-icon">🍽️</span>
                        <div class="option-title">食事中</div>
                        <div class="option-description">料理と合わせて</div>
                    </div>
                    <div class="option-card" data-value="social">
                        <span class="option-icon">👥</span>
                        <div class="option-title">人と一緒</div>
                        <div class="option-description">会話を楽しみながら</div>
                    </div>
                </div>
            </div>

            <!-- ナビゲーションボタン -->
            <div class="navigation-buttons fade-in">
                <button class="nav-button" id="prev-button" disabled>◀ 前の質問</button>
                <button class="nav-button primary" id="next-button">次の質問 ▶</button>
            </div>
        </div>

        <!-- ローディングセクション -->
        <div class="loading-section" id="loading-section">
            <div class="loading-spinner"></div>
            <div class="loading-text">AIが分析中です...</div>
            <div class="loading-subtitle">あなたの味覚傾向を解析しています</div>
        </div>

        <!-- 結果セクション -->
        <div class="result-section" id="result-section">
            <span class="result-tea-icon" id="result-icon">🍵</span>
            <h2 class="result-tea-name" id="result-name">煎茶</h2>
            <p class="result-description" id="result-description">
                バランスの取れた味わいと清涼感のある香りが特徴の、日本を代表する緑茶です。
            </p>

            <div class="result-details">
                <div class="result-detail">
                    <div class="detail-label">適合度</div>
                    <div class="detail-value" id="match-score">95%</div>
                </div>
                <div class="result-detail">
                    <div class="detail-label">水温</div>
                    <div class="detail-value" id="water-temp">70-80℃</div>
                </div>
                <div class="result-detail">
                    <div class="detail-label">抽出時間</div>
                    <div class="detail-value" id="steep-time">1-2分</div>
                </div>
                <div class="result-detail">
                    <div class="detail-label">おすすめ時間</div>
                    <div class="detail-value" id="best-time">朝・昼</div>
                </div>
            </div>

            <div class="taste-profile">
                <h3 style="text-align: center; margin-bottom: var(--space-lg); color: #2d5016;">味覚プロファイル</h3>
                <div class="taste-bar">
                    <span class="taste-label">甘味</span>
                    <div class="taste-track">
                        <div class="taste-fill" id="sweetness-bar"></div>
                    </div>
                    <span class="taste-value" id="sweetness-value">5</span>
                </div>
                <div class="taste-bar">
                    <span class="taste-label">苦味</span>
                    <div class="taste-track">
                        <div class="taste-fill" id="bitterness-bar"></div>
                    </div>
                    <span class="taste-value" id="bitterness-value">4</span>
                </div>
                <div class="taste-bar">
                    <span class="taste-label">渋味</span>
                    <div class="taste-track">
                        <div class="taste-fill" id="astringency-bar"></div>
                    </div>
                    <span class="taste-value" id="astringency-value">6</span>
                </div>
                <div class="taste-bar">
                    <span class="taste-label">旨味</span>
                    <div class="taste-track">
                        <div class="taste-fill" id="umami-bar"></div>
                    </div>
                    <span class="taste-value" id="umami-value">7</span>
                </div>
            </div>

            <div class="action-buttons">
                <a href="../tea-wheel/" class="action-button primary">🍃 フレーバーホイールで詳しく</a>
                <a href="../../contact/" class="action-button">💌 茶葉について相談</a>
                <button class="action-button" id="restart-button">🔄 もう一度診断</button>
            </div>
        </div>
    </div>
    <script src="../../assets/js/main.js"></script>
    
    <script>
        // 日本茶データベース
        const teaDatabase = {
            sencha: {
                name: "煎茶",
                icon: "🍵",
                description: "バランスの取れた味わいと清涼感のある香りが特徴の、日本を代表する緑茶です。朝の目覚めから午後のひとときまで、幅広いシーンで楽しめます。",
                waterTemp: "70-80℃",
                steepTime: "1-2分",
                bestTime: "朝・昼",
                taste: { sweetness: 5, bitterness: 4, astringency: 6, umami: 7 },
                keywords: ["バランス", "爽やか", "万能", "青草"]
            },
            gyokuro: {
                name: "玉露",
                icon: "💎",
                description: "最高級の日本茶として知られる玉露は、甘味と旨味が際立つ上品な味わい。低温でじっくりと淹れることで、その真価を発揮します。",
                waterTemp: "50-60℃",
                steepTime: "2-3分",
                bestTime: "午後・夕方",
                taste: { sweetness: 9, bitterness: 2, astringency: 3, umami: 10 },
                keywords: ["高級", "上品", "甘味", "旨味"]
            },
            matcha: {
                name: "抹茶",
                icon: "🍃",
                description: "石臼で挽いた茶葉の粉末。濃厚な味わいと鮮やかな色が特徴。茶道の精神性も感じられる、日本茶の代表格です。",
                waterTemp: "70-80℃",
                steepTime: "撹拌",
                bestTime: "いつでも",
                taste: { sweetness: 7, bitterness: 8, astringency: 5, umami: 9 },
                keywords: ["濃厚", "茶道", "石臼", "伝統"]
            },
            hojicha: {
                name: "ほうじ茶",
                icon: "🔥",
                description: "茶葉を焙煎した香ばしい香りが特徴のお茶。カフェインが少なく、夜でも安心して飲める優しい味わいです。",
                waterTemp: "90-100℃",
                steepTime: "30秒-1分",
                bestTime: "夜・リラックス",
                taste: { sweetness: 6, bitterness: 3, astringency: 2, umami: 4 },
                keywords: ["香ばしい", "焙煎", "夜", "リラックス"]
            },
            genmaicha: {
                name: "玄米茶",
                icon: "🌾",
                description: "緑茶と炒った玄米をブレンドしたお茶。香ばしい玄米の香りとさっぱりとした味わいが特徴。食事との相性も抜群です。",
                waterTemp: "90-100℃",
                steepTime: "30秒",
                bestTime: "食後",
                taste: { sweetness: 5, bitterness: 2, astringency: 3, umami: 3 },
                keywords: ["玄米", "香ばしい", "食事", "ブレンド"]
            },
            fukamushicha: {
                name: "深蒸し茶",
                icon: "💚",
                description: "通常より長時間蒸した茶葉で作るお茶。濃厚でまろやかな味わいが特徴。色が濃く、コクのある風味を楽しめます。",
                waterTemp: "70-80℃",
                steepTime: "45秒",
                bestTime: "朝・昼",
                taste: { sweetness: 6, bitterness: 5, astringency: 7, umami: 8 },
                keywords: ["濃厚", "コク", "深蒸し", "まろやか"]
            },
            bancha: {
                name: "番茶",
                icon: "🌿",
                description: "成長した茶葉を使用したお茶。すっきりとした味わいで飲みやすく、日常的に楽しめるお茶です。",
                waterTemp: "80-90℃",
                steepTime: "1分",
                bestTime: "食事中",
                taste: { sweetness: 3, bitterness: 3, astringency: 4, umami: 4 },
                keywords: ["すっきり", "日常", "食事", "軽やか"]
            },
            shincha: {
                name: "新茶",
                icon: "🌱",
                description: "その年の最初に摘まれた一番茶。フレッシュな香りと甘味が特徴の季節限定のお茶です。",
                waterTemp: "70℃",
                steepTime: "1分",
                bestTime: "午前中",
                taste: { sweetness: 8, bitterness: 3, astringency: 5, umami: 7 },
                keywords: ["フレッシュ", "季節", "一番茶", "甘味"]
            }
        };

        // AI診断ロジック
        class TeaAIDiagnosis {
            constructor() {
                this.currentQuestion = 1;
                this.totalQuestions = 5;
                this.answers = {};
                this.isCompleted = false;
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.updateProgress();
            }

            setupEventListeners() {
                // オプション選択
                document.querySelectorAll('.option-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        this.selectOption(e.currentTarget);
                    });
                });

                // ナビゲーションボタン
                document.getElementById('prev-button').addEventListener('click', () => {
                    this.previousQuestion();
                });

                document.getElementById('next-button').addEventListener('click', () => {
                    this.nextQuestion();
                });

                // リスタートボタン
                document.getElementById('restart-button').addEventListener('click', () => {
                    this.restart();
                });
            }

            selectOption(card) {
                const questionCard = card.closest('.question-card');
                const questionNum = parseInt(questionCard.dataset.question);
                const value = card.dataset.value;

                // 同じ質問内の他の選択を解除
                questionCard.querySelectorAll('.option-card').forEach(c => {
                    c.classList.remove('selected');
                });

                // 選択状態にする
                card.classList.add('selected');
                
                // 答えを保存
                this.answers[questionNum] = value;

                // ナビゲーションボタンの状態更新
                this.updateNavigationButtons();

                // 選択エフェクト
                card.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    card.style.transform = '';
                }, 200);
            }

            updateNavigationButtons() {
                const prevButton = document.getElementById('prev-button');
                const nextButton = document.getElementById('next-button');

                // 前へボタン
                prevButton.disabled = this.currentQuestion === 1;

                // 次へボタン
                const hasAnswer = this.answers[this.currentQuestion];
                if (this.currentQuestion === this.totalQuestions) {
                    nextButton.textContent = hasAnswer ? '診断結果を見る ✨' : '回答を選択してください';
                    nextButton.disabled = !hasAnswer;
                } else {
                    nextButton.textContent = hasAnswer ? '次の質問 ▶' : '回答を選択してください';
                    nextButton.disabled = !hasAnswer;
                }
            }

            nextQuestion() {
                if (this.currentQuestion < this.totalQuestions) {
                    this.showQuestion(this.currentQuestion + 1);
                } else {
                    this.showResults();
                }
            }

            previousQuestion() {
                if (this.currentQuestion > 1) {
                    this.showQuestion(this.currentQuestion - 1);
                }
            }

            showQuestion(questionNum) {
                // 現在の質問を非表示
                document.querySelectorAll('.question-card').forEach(card => {
                    card.classList.remove('active');
                });

                // 新しい質問を表示
                const targetQuestion = document.querySelector(`[data-question="${questionNum}"]`);
                if (targetQuestion) {
                    setTimeout(() => {
                        targetQuestion.classList.add('active');
                    }, 300);
                }

                this.currentQuestion = questionNum;
                this.updateProgress();
                this.updateNavigationButtons();

                // 既に答えがある場合は選択状態を復元
                if (this.answers[questionNum]) {
                    const selectedOption = targetQuestion.querySelector(`[data-value="${this.answers[questionNum]}"]`);
                    if (selectedOption) {
                        selectedOption.classList.add('selected');
                    }
                }
            }

            updateProgress() {
                document.getElementById('current-question').textContent = this.currentQuestion;
                document.getElementById('total-questions').textContent = this.totalQuestions;
                
                const progress = (this.currentQuestion / this.totalQuestions) * 100;
                document.getElementById('progress-fill').style.width = progress + '%';
            }

            async showResults() {
                // 診断コンテナを非表示
                document.querySelector('.diagnosis-container').style.display = 'none';
                
                // ローディング表示
                document.getElementById('loading-section').style.display = 'block';

                // AIによる分析シミュレーション
                await this.simulateAIAnalysis();

                // 結果を計算
                const result = this.calculateResult();

                // ローディング非表示
                document.getElementById('loading-section').style.display = 'none';

                // 結果表示
                this.displayResult(result);
            }

            async simulateAIAnalysis() {
                // AIの分析過程をシミュレーション
                const steps = [
                    "味覚傾向を分析中...",
                    "香りの好みを解析中...",
                    "生活パターンを評価中...",
                    "最適な茶葉を選定中...",
                    "診断結果を生成中..."
                ];

                for (let i = 0; i < steps.length; i++) {
                    document.querySelector('.loading-subtitle').textContent = steps[i];
                    await new Promise(resolve => setTimeout(resolve, 800));
                }
            }

            calculateResult() {
                const answers = this.answers;
                let scores = {};

                // 各茶葉に対してスコアを計算
                Object.keys(teaDatabase).forEach(teaKey => {
                    scores[teaKey] = this.calculateTeaScore(teaDatabase[teaKey], answers);
                });

                // 最高スコアの茶葉を選択
                const bestTea = Object.keys(scores).reduce((a, b) => 
                    scores[a] > scores[b] ? a : b
                );

                return {
                    tea: teaDatabase[bestTea],
                    score: Math.round(scores[bestTea]),
                    allScores: scores
                };
            }

            calculateTeaScore(tea, answers) {
                let score = 0;

                // 時間帯による適合性
                const timeScore = this.getTimeScore(tea, answers[1]);
                score += timeScore * 20;

                // 味の好みによる適合性
                const tasteScore = this.getTasteScore(tea, answers[2]);
                score += tasteScore * 25;

                // 香りの好みによる適合性
                const aromaScore = this.getAromaScore(tea, answers[3]);
                score += aromaScore * 20;

                // 濃さの好みによる適合性
                const strengthScore = this.getStrengthScore(tea, answers[4]);
                score += strengthScore * 15;

                // シーンによる適合性
                const sceneScore = this.getSceneScore(tea, answers[5]);
                score += sceneScore * 20;

                return score;
            }

            getTimeScore(tea, timeAnswer) {
                const timeMapping = {
                    'morning': ['朝', '午前'],
                    'afternoon': ['昼', '午後'],
                    'evening': ['夕方'],
                    'night': ['夜', 'リラックス']
                };

                const preferredTimes = timeMapping[timeAnswer] || [];
                return preferredTimes.some(time => tea.bestTime.includes(time)) ? 1 : 0.3;
            }

            getTasteScore(tea, tasteAnswer) {
                const tasteMapping = {
                    'sweet': 'sweetness',
                    'bitter': 'bitterness',
                    'astringent': 'astringency',
                    'umami': 'umami'
                };

                const targetTaste = tasteMapping[tasteAnswer];
                if (!targetTaste) return 0.5;

                const tasteValue = tea.taste[targetTaste];
                return tasteValue / 10; // 0-1の範囲に正規化
            }

            getAromaScore(tea, aromaAnswer) {
                const aromaMapping = {
                    'fresh': ['青草', '爽やか', 'フレッシュ'],
                    'floral': ['花香', '上品', '華やか'],
                    'roasted': ['香ばしい', '焙煎', 'ロースト'],
                    'marine': ['海苔', '海藻', '深み']
                };

                const aromaKeywords = aromaMapping[aromaAnswer] || [];
                const hasMatchingAroma = aromaKeywords.some(keyword => 
                    tea.keywords.some(teaKeyword => teaKeyword.includes(keyword))
                );

                return hasMatchingAroma ? 1 : 0.3;
            }

            getStrengthScore(tea, strengthAnswer) {
                // 茶葉の強度を推定（苦味+渋味の合計で判定）
                const teaStrength = (tea.taste.bitterness + tea.taste.astringency) / 2;
                
                const strengthMapping = {
                    'light': [0, 4],
                    'medium': [3, 7],
                    'strong': [6, 10]
                };

                const [min, max] = strengthMapping[strengthAnswer] || [0, 10];
                return (teaStrength >= min && teaStrength <= max) ? 1 : 0.3;
            }

            getSceneScore(tea, sceneAnswer) {
                const sceneMapping = {
                    'work': ['朝', '昼', '集中'],
                    'relax': ['夜', 'リラックス'],
                    'meal': ['食事', '食後'],
                    'social': ['いつでも', '万能']
                };

                const sceneKeywords = sceneMapping[sceneAnswer] || [];
                const hasMatchingScene = sceneKeywords.some(keyword => 
                    tea.bestTime.includes(keyword) || tea.keywords.some(k => k.includes(keyword))
                );

                return hasMatchingScene ? 1 : 0.5;
            }

            displayResult(result) {
                const resultSection = document.getElementById('result-section');
                
                // 結果データを表示
                document.getElementById('result-icon').textContent = result.tea.icon;
                document.getElementById('result-name').textContent = result.tea.name;
                document.getElementById('result-description').textContent = result.tea.description;
                document.getElementById('match-score').textContent = result.score + '%';
                document.getElementById('water-temp').textContent = result.tea.waterTemp;
                document.getElementById('steep-time').textContent = result.tea.steepTime;
                document.getElementById('best-time').textContent = result.tea.bestTime;

                // 味覚プロファイルを更新
                Object.entries(result.tea.taste).forEach(([taste, value]) => {
                    const bar = document.getElementById(`${taste}-bar`);
                    const valueSpan = document.getElementById(`${taste}-value`);
                    
                    if (bar && valueSpan) {
                        setTimeout(() => {
                            bar.style.width = (value * 10) + '%';
                        }, 500);
                        valueSpan.textContent = value;
                    }
                });

                // 結果セクションを表示
                resultSection.style.display = 'block';
                
                // スムーズにスクロール
                setTimeout(() => {
                    resultSection.scrollIntoView({ behavior: 'smooth' });
                }, 300);

                this.isCompleted = true;
            }

            restart() {
                // リセット
                this.currentQuestion = 1;
                this.answers = {};
                this.isCompleted = false;

                // UI リセット
                document.querySelector('.diagnosis-container').style.display = 'block';
                document.getElementById('result-section').style.display = 'none';
                document.getElementById('loading-section').style.display = 'none';

                // 全ての選択状態をクリア
                document.querySelectorAll('.option-card').forEach(card => {
                    card.classList.remove('selected');
                });

                // 最初の質問を表示
                this.showQuestion(1);

                // トップにスクロール
                document.querySelector('.diagnosis-hero').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // アプリケーション初期化
        let teaAI;

        document.addEventListener('DOMContentLoaded', () => {
            teaAI = new TeaAIDiagnosis();
        });

        // アプリ読み込み完了時の処理
        document.addEventListener('app:loaded', () => {
            console.log('🤖 日本茶AI診断が正常に読み込まれました！');
        });
    </script>
    
    <!-- 共通フッター -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <a href="../../" class="footer-logo">nemotea.dev</a>
                    <p class="footer-description">
                        Tea-Driven Development - Technology meets Creativity
                    </p>
                </div>
                
                <div class="footer-links">
                    <a href="../../" class="footer-link">Home</a>
                    <a href="../../profile/" class="footer-link">Profile</a>
                    <a href="../../works/" class="footer-link">Works</a>
                    <a href="../../contact/" class="footer-link">Contact</a>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p class="footer-copyright">
                    © 2025 nemotea. Built with passion for technology and creativity.
                </p>
            </div>
        </div>
    </footer>

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Tea AI Diagnosis",
        "description": "質問に答えて最適な日本茶を推奨するAI診断システム",
        "url": "https://nemototea.github.io/special-features/tea-ai-diagnosis/",
        "applicationCategory": "Lifestyle",
        "operatingSystem": "Web Browser",
        "creator": {
            "@type": "Person",
            "name": "nemotea"
        }
    }
    </script>
</body>
</html>